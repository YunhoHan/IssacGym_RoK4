# used to create the object
name: RoK4

physics_engine: 'physx'

env:
  numEnvs: ${resolve_default:4096,${...num_envs}}
  numObservations: 56
  numJointActions: 13
  numActions: 17
  envSpacing: 1.  # [m]
  enableDebugVis: False
  test: True

  terrain:
    terrainType: plane # none, plane, or trimesh
    staticFriction: 1.0  # [-]
    dynamicFriction: 1.0  # [-]
    restitution: 0.        # [-]
    # rough terrain only:
    curriculum: true
    maxInitMapLevel: 0
    mapLength: 8.
    mapWidth: 8.
    numLevels: 10
    numTerrains: 20
    # terrain types: [smooth slope, rough slope, stairs up, stairs down, discrete]
    terrainProportions: [0.1, 0.1, 0.35, 0.25, 0.2]
    # tri mesh only:
    slopeTreshold: 0.5

  baseInitState:
    pos: [0.0442, 0, 0.98268] # x,y,z [m] # 0.0442 0 0.905 gait ready x,  #0.95268 < = with legs stretched out 0.95268

    rot: [0.0, 0.0, 0.0, 1.0] # x,y,z,w [quat]
    vLinear: [0.0, 0.0, 0.0]  # x,y,z [m/s]
    vAngular: [0.0, 0.0, 0.0]  # x,y,z [rad/s]

  randomCommandVelocityRanges:
    # train
    linear_x: [-0.3, 0.7] # min max [m/s] <- forward velocity
    linear_y: [-0.3, 0.3]   # min max [m/s] <- sideways velocity
    yaw: [-0.8, 0.8]    # min max [rad/s] <- yaw angular velocity

  EnvsNumRanges:
    stand_env_range               : 200
    only_plus_x_envs_range        : 200 
    only_minus_x_envs_range       : 200
    only_plus_y_envs_range        : 200
    only_minus_y_envs_range       : 200
    only_plus_yaw_envs_range      : 200
    only_minus_yaw_envs_range     : 200
    plus_x_plus_yaw_envs_range    : 200
    plus_x_minus_yaw_envs_range   : 200
    minus_x_plus_yaw_envs_range   : 200
    minus_x_minus_yaw_envs_range  : 200


  control:
    # PD Drive parameters:
    # stiffness: 80.0  # [N*m/rad]
    # damping: 2.0     # [N*m*s/rad]
    
    # PD Drive parameters:
    # RMD_x12_150_kt 2.5
    # RMD_x8_90_kt 3.0
    # Kp: [600.0, 600.0, 600.0, 600.0, 600.0, 600.0,        # 왼다리 (LHY, LHR, LHP, LKN, LAP, LAR)
    #      600.0, 600.0, 600.0, 600.0, 600.0, 600.0,        # 오른다리 (RHY, RHR, RHP, RKN, RAP, RAR)
    #      480.0]                                           # 허리 (WST)  [cur/rad]

    # Kd: [6.0, 6.0, 6.0, 6.0, 6.0, 6.0,                    # 왼다리 (LHY, LHR, LHP, LKN, LAP, LAR)
    #      6.0, 6.0, 6.0, 6.0, 6.0, 6.0,                    # 오른다리 (RHY, RHR, RHP, RKN, RAP, RAR)
    #      4.8]                                             # 허리 (WST)    [cur*s/rad]

    # Kp: [1500.0, 1500.0, 1500.0, 1500.0, 1800.0, 1800.0,  # 왼다리 (LHY, LHR, LHP, LKN, LAP, LAR)
    #      1500.0, 1500.0, 1500.0, 1500.0, 1800.0, 1800.0,  # 오른다리 (RHY, RHR, RHP, RKN, RAP, RAR)
    #      1200.0]                                          # 허리 (WST)  [N*m/rad]

    # Kd: [15.0, 15.0, 15.0, 15.0, 15.0, 18.0,              # 왼다리 (LHY, LHR, LHP, LKN, LAP, LAR)
    #      15.0, 15.0, 15.0, 15.0, 15.0, 18.0,              # 오른다리 (RHY, RHR, RHP, RKN, RAP, RAR)
    #      12.0]                                            # 허리 (WST)    [N*m*s/rad]
    
    Kp: [75.0, 75.0, 150.0, 150.0, 90.0, 90.0,    # 왼다리 (LHY, LHR, LHP, LKN, LAP, LAR)
         75.0, 75.0, 150.0, 150.0, 90.0, 90.0,    # 오른다리 (RHY, RHR, RHP, RKN, RAP, RAR)
         75.0]                                       # 허리 (WST)  [N*m/rad]

    Kd: [2.5, 2.5, 5.0, 5.0, 3.0, 3.0,                # 왼다리 (LHY, LHR, LHP, LKN, LAP, LAR)
         2.5, 2.5, 5.0, 5.0, 3.0, 3.0,                # 오른다리 (RHY, RHR, RHP, RKN, RAP, RAR)
         2.5]                                         # 허리 (WST)    [N*m*s/rad]

    # action scale: target angle = actionScale * action + defaultAngle
    actionScale: 0.5
    # decimation: Number of control action updates @ sim DT per policy DT
    decimation: 4

  dof_properties:
    torque_limits: [ 150.0, 150.0, 300.0, 480.0, 180.0, 180.0,  # L_Leg
                     150.0, 150.0, 300.0, 480.0, 180.0, 180.0,  # R_Leg
                     150.0]                                     # Torso

    damping:   [0.250538652440252, 0.250538652440252, 0.50107730488, 0.50107730488, 0.130617712993805, 0.130617712993805,
                0.250538652440252, 0.250538652440252, 0.50107730488, 0.50107730488, 0.130617712993805, 0.130617712993805,
                0.250538652440252]

    friction:  [0.226537899603487, 0.226537899603487, 0.4530757992, 3.39806849405, 1.79822954112, 1.79822954112,
                0.226537899603487, 0.226537899603487, 0.4530757992, 3.39806849405, 1.79822954112, 1.79822954112,
                0.226537899603487]

    armature:  [0.087396415395941, 0.087396415395941, 0.17479283079, 0.17479283079, 0.084040769086151, 0.084040769086151,
                0.087396415395941, 0.087396415395941, 0.17479283079, 0.17479283079, 0.084040769086151, 0.084040769086151,
                0.087396415395941]

  defaultJointAngles:  # = target angles when action = 0.0
    # # 왼쪽 다리 (Left Leg)
    L_Hip_Yaw_Joint     : -0.0   
    L_Hip_Roll_Joint    : -0.0   
    L_Hip_Pitch_Joint   : -0.29670597283   
    L_Knee_Pitch_Joint  :  0.72954762733   
    L_Ankle_Pitch_Joint : -0.43284165449   
    L_Ankle_Roll_Joint  : -0.0 

    # 오른쪽 다리 (Right Leg)
    R_Hip_Yaw_Joint     : -0.0  
    R_Hip_Roll_Joint    : -0.0
    R_Hip_Pitch_Joint   : -0.29670597283
    R_Knee_Pitch_Joint  :  0.72954762733
    R_Ankle_Pitch_Joint : -0.43284165449
    R_Ankle_Roll_Joint  : -0.0

    # # 몸통 (Torso)
    Torso_Yaw_Joint       : 0.000000   # Joint 0 (0.000000 degrees)

  urdfAsset:
    file: "urdf/rok4/urdf/rok4_train.urdf"
    test_file: "urdf/rok4/urdf/rok4_train.urdf" #"urdf/rok3_model/urdf/rok3_model(view).urdf"
    footName: Foot # SHANK if collapsing fixed joint, FOOT otherwise
    kneeName: Thigh
    calfName: Calf
    collapseFixedJoints: false
    fixBaseLink: false
    defaultDofDriveMode: 4 # see GymDofDriveModeFlags (0 is none, 1 is pos tgt, 2 is vel tgt, 4 effort)

  learn:
    allowKneeContacts: true
    # 
    rew_scales:
      # === Main Rewards (주요 보상 관련) ===
      terminalReward: 0.0
      linearVelocityXYRewardScale: 1.5
      angularVelocityZRewardScale: 0.75
      feetAirTimeRewardScale: 0.0

    pen_scales:
      # === Base Motion (명령 추종 관련) ===
      linearVelocityZRewardScale: -0.05     # Z축 속도
      angularVelocityXYRewardScale: -0.005  # Roll/Pitch 각속도     

      # === CoM Stability (안정성 관련)  ===
      comHeight: -0.0              # CoM 높이 유지
      comSupport: -0.0             # CoM 위치 안정성 (지지 다각형 내 유지)
      comVelZ: -0.0                # CoM Z축 속도

      # === Body Orientation (자세 관련) ===
      baseHeightRewardScale: -2.5 # 몸통 높이 유지   
      baseOrientation: -5.0        # 0.1 몸통 기울기 

      # === Gait Related (보행 리듬 관련) ===
      swingStancePhase: -0.5
      footHeight: -0.275
      footSlip: -0.025 # 0.015 -> 0.15

      # === Leg Placement (다리 위치 관련) ===
      footGapY: -0.3  # 0.15
      legGapY: -0.2   # 0.1
      footGapXStanding: -0.05

      # === Unnecessary Motion (불필요한 움직임 관련) ===
      hipYaw: -0.025
      hipRoll: -0.025
      ankleRoll: -0.05

      # === Safety & Limits (안전 및 한계 관련) ===
      kneeCollisionRewardScale: -0.1 #
      calfCollisionRewardScale: -0.1 #
      jumpPenalty: -0.15
      dofLimit: -5.0         
      actionLimit: -0.001      
      dofVelLimit: -0.001     

      # === Efficiency & Smoothness (효율/부드러움 관련) ===
      torqueRewardScale: -2e-07   # 
      jointAccRewardScale: -0.00005 # 
      actionRateRewardScale: -0.0005 # (Smoothness 1차)
      actionSmoothness2RewardScale: -0.0005
      jointEnergy: -0.0

      # === Cosmetics (기타) ===
      defaultPosStanding: -0.05
      hipRewardScale: -0.0         # (기존 이름 유지, 나중에 삭제 고려)

    # observation normalization scales
    obs_scales:
      linearVelocityScale: 1.0
      angularVelocityScale: 0.25
      dofPositionScale: 1.0
      dofVelocityScale: 1.0
      heightMeasurementScale: 5.0

    # noise 
    noise:
      addNoise: true
      noiseLevel: 1.0 # scales other values
      dofPositionNoise: 0.01
      dofVelocityNoise: 1.5
      linearVelocityNoise: 0.1
      angularVelocityNoise: 0.2
      gravityNoise: 0.05
      heightMeasurementNoise: 0.06

    #randomization
    randomizeFriction: true
    frictionRange: [0.5, 1.25]
    pushRobots: true
    pushInterval_s: 15
    freezecmdInterval_s : 15

    # episode length in seconds
    episodeLength_s: 20

  # viewer cam:
  viewer:
    refEnv: 0
    pos: [0, 0, 10]  # [m]
    lookat: [1., 1, 9]  # [m]

  # set to True if you use camera sensors in the environment
  enableCameraSensors: False

sim:
  dt: 0.002
  substeps: 1
  up_axis: "z"
  use_gpu_pipeline: ${eq:${...pipeline},"gpu"}
  gravity: [0.0, 0.0, -9.81]
  physx:
    num_threads: ${....num_threads}
    solver_type: ${....solver_type}
    use_gpu: ${contains:"cuda",${....sim_device}} # set to False to run on CPU
    num_position_iterations: 4
    num_velocity_iterations: 1
    contact_offset: 0.02
    rest_offset: 0.0
    bounce_threshold_velocity: 0.2
    max_depenetration_velocity: 100.0
    default_buffer_size_multiplier: 5.0
    max_gpu_contact_pairs: 8388608 # 8*1024*1024
    num_subscenes: ${....num_subscenes}
    contact_collection: 1 # 0: CC_NEVER (don't collect contact info), 1: CC_LAST_SUBSTEP (collect only contacts on last substep), 2: CC_ALL_SUBSTEPS (broken - do not use!)

task:
  randomize: False
